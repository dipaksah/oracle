/*
    NOTE:
    directory path must be an database server location.
    Below /data1/aipfs is database server location and is mounted on /aipfs
*/
create or replace directory oracle_utl_test AS '/data1/aipfs/test_shell_script/oracle_utl';

/
--Simple way to test utl_file 
DECLARE
    l_file  UTL_FILE.FILE_TYPE;
BEGIN
    l_file := UTL_FILE.FOPEN('ORACLE_UTL_TEST','utl_file_test_output.txt','W');
    UTL_FILE.PUT_LINE(l_file,'UTL TEST DEMO File');
    UTL_FILE.PUT_LINE(l_file,'This is first code practice of utl_file in oracle sql');
    UTL_FILE.FCLOSE(l_file);
END;
/


--To generate CSV file
DECLARE
    l_file UTL_FILE.FILE_TYPE;
BEGIN
    --Open file to writing
    l_file := UTL_FILE.FOPEN('ORACLE_UTL_TEST','utl_excel_file_test_output.csv','W');
    
    --Write header row
    UTL_FILE.PUT_LINE(l_file, 'name,address,salary');
    
    --write data
    FOR i IN (
        SELECT
            name,
            address,
            salary
        FROM
            test_duplicate
    ) LOOP
        utl_file.put_line(l_file, i.name
                                  || ','
                                  || i.address
                                  || ','
                                  || i.salary);
    END LOOP;
    
    --Close the file
    UTL_FILE.FCLOSE(l_file);
END;
/
