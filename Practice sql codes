--example code
create table test_duplicate(
    name varchar(100),
    address varchar(100),
    salary integer
);

insert into test_duplicate(name,address,salary)values('abc','pokhara',10000);
insert into test_duplicate(name,address,salary)values('abc','pokhara',10000);
insert into test_duplicate(name,address,salary)values('abc','pokhara',10000);
insert into test_duplicate(name,address,salary)values('xyz','kathmandu',20000);
insert into test_duplicate(name,address,salary)values('xyz','kathmandu',20000);
insert into test_duplicate(name,address,salary)values('xyz','kathmandu',20000);
insert into test_duplicate(name,address,salary)values('aaa','simara',40000);
insert into test_duplicate(name,address,salary)values('bbb','janakpur',50000);
/

--Ways of duplicate data deletion
1) Method
Delete from  test_rownumber where rowid IN (
select rowid from (
select 
    process_label,
    row_number() over (partition by process_label , process_label order by rowid) as rn
from 
    test_rownumber where process_label = 'xyz'
) where rn <> 1
);

2) Method
--delete from (
delete from (
select * from test_rownumber where rowid not in (
select min(rowid) from test_rownumber group by process_label
)and process_label = 'abc');

3) Method
--Through sql server Note: this will not work in oracle because oracle did not support directly deleting from CTE 
delete from (
with a as (
    select 
        process_label,
        row_number() over (partition by process_label order by null) as rn
    from 
        test_rownumber
    where process_label = 'abc'
)
select * from a where rn <> 1);

--Find duplciate rows
SELECT
    name,
    address,
    salary,
    COUNT(*) AS dup
FROM
    test_duplicate
GROUP BY
    name,
    address,
    salary
HAVING
    COUNT(*) > 1;

--postGresSQL 
--find duplicate rows below query work in postgressql only
SELECT *
FROM (
    SELECT
        td.*,
        RANK() OVER (PARTITION BY row(td.*) ORDER BY ctid) rn
    FROM test_duplicate td
) t  
WHERE rn > 1;

--find 50% of records - oracle
SELECT
    *
FROM
    test_duplicate
WHERE
    ROWNUM <= (
        SELECT
            COUNT(*) / 2
        FROM
            test_duplicate
    );

--find 50% of records - postgresssql
SELECT
    *
FROM
    test_duplicate
    limit (
        SELECT
            COUNT(ctid) / 2
        FROM
            test_duplicate
    );

--find second highest salary with full details of employe
SELECT
    MAX(salary)
FROM
    test_duplicate
WHERE
    salary < (
        SELECT
            MAX(salary)
        FROM
            test_duplicate
    );

--find first,second,third,fourth......n highest salary with full details of employe
SELECT
    *
FROM
    (
        SELECT
            td.*,
            ROW_NUMBER()
            OVER(
                ORDER BY
                    salary DESC
            ) rn
        FROM
            test_duplicate td
    ) t
WHERE
    rn = 2;
